<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASUS PM LAB PRO - Wolf Huang</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .interactive-word:hover { background-color: #4f46e5; color: white; border-radius: 4px; }
        .glass-sidebar { background: #0f172a; }
        textarea:focus { outline: none; }
        .item-subject-row { display: flex; align-items: flex-start; justify-content: space-between; gap: 1rem; border-bottom: 1px solid #f1f5f9; padding-bottom: 0.5rem; margin-bottom: 0.75rem; }
        
        /* AI 生成中的互動效果 */
        .ai-loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
            z-index: 10;
            border-radius: inherit;
        }
        .dark-ai-loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
            z-index: 10;
            border-radius: inherit;
        }
        .pulse-text {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden text-sm">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;
        const apiKey = ""; // 執行環境提供的 Key

        const Icon = ({ name, size = 16, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        // --- PCM16 to WAV Helper for TTS ---
        function pcmToWav(pcmBase64, sampleRate = 24000) {
            const byteCharacters = atob(pcmBase64);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) { byteNumbers[i] = byteCharacters.charCodeAt(i); }
            const pcmData = new Uint8Array(byteNumbers);
            const buffer = new ArrayBuffer(44 + pcmData.length);
            const view = new DataView(buffer);
            const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) { view.setUint8(offset + i, string.charCodeAt(i)); } };
            writeString(0, 'RIFF'); view.setUint32(4, 32 + pcmData.length, true); writeString(8, 'WAVE');
            writeString(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true); view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true); view.setUint16(34, 16, true);
            writeString(36, 'data'); view.setUint32(40, pcmData.length, true);
            pcmData.forEach((byte, i) => view.setUint8(44 + i, byte));
            return new Blob([buffer], { type: 'audio/wav' });
        }

        const App = () => {
            const [activeTab, setActiveTab] = useState(0);
            const [isGenerating, setIsGenerating] = useState(false);
            const [syncTarget, setSyncTarget] = useState(null); // 紀錄目前正在同步的 ID
            const [isPlaying, setIsPlaying] = useState(null);
            const [notification, setNotification] = useState(null);
            const [playbackSpeed, setPlaybackSpeed] = useState(1.0);
            const [appsScriptUrl, setAppsScriptUrl] = useState("");
            const [sheetUrl, setSheetUrl] = useState("");
            const [userApiKey, setUserApiKey] = useState("");
            
            const [systemPrompt, setSystemPrompt] = useState(
                "你是一位資深的 ASUS 全球電商專案管理專家。請將中文內容翻譯成高水準、專業且具備執行力的商業英文。專注於「複雜性、規模化、結構化、可預測性」等專業術語。句子盡量不要太長，但要保持可理解的中等程度。所有輸出的解釋與定義必須使用「繁體中文」。"
            );

            const [data, setData] = useState({
                intro: {
                    zh: `你好，我是黃詳淵 Wolf，一位 PMP 認證、擁有超過 14 年經驗的跨域專案與數位轉型工作者。我的核心專長是：在資源受限環境中理出路徑，將混亂建成可交付、可規模化的結構。\n\n我的職涯三階段：\n1. 音樂創業期：培養極強的行動力與從零到一的適應力。\n2. IT 服務業：深耕 C#、SQL 技術底層，並為製造業規劃數位轉型藍圖。\n3. PMO 治理：在 SoftBI 建立跨專案交付治理系統，將效能提升 6 倍。\n\n現在，我希望將這套在資源受限環境中磨出的能力帶到 ASUS，在電商 PM 角色放大全球影響力。`,
                    en: `Hi, I’m Wolf Huang, a PMP-certified professional with over 14 years of experience. My core strength is building structure in complex environments — turning chaos into scalable delivery systems. My career has three phases: music entrepreneurship, IT services, and PMO governance. I've completed the cycle from startup to scale and am ready to amplify my impact at ASUS.`
                },
                star: [
                    {
                        skill: "跨部門溝通與利害關係人管理 (PMO)",
                        zh: { context: "在 SoftBI 擔任 PMO，管理 50+ 專案與 20+ 團隊。", action: "建立 AI 自動化週報系統，將原本需 3 小時的手動回報縮短至 30 分鐘。", result: "溝通成本降低 60%，協助公司穩定進入產品交付擴大期。" },
                        en: { context: "", action: "", result: "" }
                    }
                ],
                homebase: [
                    { q: "你的英文能力是否足以應付跨國工作？", framework: "Split Framework", zh: "我透過 Vibe Coding 與 AI 互動學會很多技術。這場面試的準備就是我自主學習能力的證明。", en: "" }
                ],
                seei: [
                    { topic: "我最大的缺點是什麼？", zh: "早期較依賴個人直覺。但這促使我考取 PMP 認證，學習將『個人智慧』轉化為『組織資產』。", en: "" }
                ],
                reverse_qs: [
                    { zh: "ASUS Store 未來在 B2B 與 D2C 的整合戰略中，最大的技術挑戰是什麼？", en: "" }
                ],
                vocabulary: []
            });

            const notify = (msg, type = 'success') => { setNotification({ message: msg, type }); setTimeout(() => setNotification(null), 3000); };
            const tabsMapping = ["intro", "star", "homebase", "seei", "reverse_qs", "vocabulary"];

            // --- API 指令封裝 (參考原始檔案調用邏輯) ---
            const askAI = async (prompt, asJson = false) => {
                const finalKey = userApiKey || apiKey;
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${finalKey}`;
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    generationConfig: asJson ? { responseMimeType: "application/json" } : {}
                };

                let delay = 1000;
                for (let i = 0; i < 5; i++) {
                    try {
                        const res = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (res.ok) {
                            const result = await res.json();
                            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                            if (text) return text;
                            throw new Error("Empty response");
                        }
                        if (res.status === 429 || res.status >= 500) {
                            await new Promise(r => setTimeout(r, delay));
                            delay *= 2;
                            continue;
                        }
                        const err = await res.json();
                        throw new Error(err.error?.message || "Request Error");
                    } catch (e) {
                        if (i === 4) throw e;
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                    }
                }
                throw new Error("API call failed after retries");
            };

            const cleanJSON = (text) => {
                const match = text.match(/\{[\s\S]*\}|\[[\s\S]*\]/);
                return match ? match[0] : text;
            };

            const syncEnglish = async (section, index = null) => {
                const finalKey = userApiKey || apiKey;
                if (!finalKey) return notify("請填寫 API Key", "error");
                
                const targetId = index !== null ? `${section}-${index}` : section;
                setIsGenerating(true);
                setSyncTarget(targetId);

                let prompt = "";
                const isStar = section === 'star';
                
                try {
                    const currentSection = data[section];
                    if (section === 'intro') prompt = `Translate this self-intro: ${currentSection.zh}`;
                    else if (isStar) prompt = `Translate STAR JSON {context, action, result} to professional English. Return ONLY JSON. Input: ${JSON.stringify(currentSection[index].zh)}`;
                    else if (section === 'homebase' || section === 'seei') prompt = `Translate response: ${currentSection[index].zh}`;
                    else if (section === 'reverse_qs') prompt = `Translate interview question: ${currentSection[index].zh}`;

                    const text = await askAI(prompt, isStar);
                    const newData = { ...data };
                    
                    if (section === 'intro') newData.intro.en = text;
                    else if (isStar) newData.star[index].en = JSON.parse(cleanJSON(text));
                    else if (section === 'homebase') newData.homebase[index].en = text;
                    else if (section === 'seei') newData.seei[index].en = text;
                    else if (section === 'reverse_qs') newData.reverse_qs[index].en = text;
                    
                    setData(newData); notify("AI 翻譯成功");
                } catch (e) { 
                    console.error("Translation Error:", e); 
                    notify(e.message, "error"); 
                }
                setIsGenerating(false);
                setSyncTarget(null);
            };

            const addSpecificWord = async (word) => {
                const finalKey = userApiKey || apiKey;
                const clean = word.toLowerCase().replace(/[^a-z]/g, "");
                if (clean.length < 3 || !finalKey) return;
                notify(`處理單字: ${clean}...`, 'info');
                try {
                    const text = await askAI(`Define "${clean}" for a PM. Ensure Traditional Chinese output. Return JSON {word, zh, desc, difficulty_score}`, true);
                    const json = JSON.parse(cleanJSON(text));
                    const newData = { ...data };
                    const idx = newData.vocabulary.findIndex(v => v.word.toLowerCase() === clean);
                    if (idx > -1) newData.vocabulary[idx].count += 1; else newData.vocabulary.push({ ...json, count: 1 });
                    setData(newData); notify(`「${clean}」已入單字庫`);
                } catch (e) {}
            };

            const generateVocabulary = async () => {
                if (!(userApiKey || apiKey)) return notify("請輸入 API Key", "error");
                setIsGenerating(true);
                setSyncTarget('vocabulary');
                const allEn = [data.intro.en, ...data.star.flatMap(s => [s.en.context, s.en.action, s.en.result]), ...data.homebase.map(h => h.en), ...data.seei.map(s => s.en), ...data.reverse_qs.map(r => r.en)].filter(Boolean).join(" ");
                const cleanWords = allEn.toLowerCase().replace(/[^a-z ]/g, "").split(/\s+/).filter(w => w.length > 5);
                const uniqueCandidates = [...new Set(cleanWords)].slice(0, 15);
                try {
                    const text = await askAI(`Pick 8 PM keywords from: ${uniqueCandidates.join(",")}. Output must be TRADITIONAL CHINESE. Return JSON array [{word, zh, desc, difficulty_score}].`, true);
                    const json = JSON.parse(cleanJSON(text));
                    const newData = { ...data };
                    json.forEach(i => { if (!newData.vocabulary.some(v => v.word === i.word)) newData.vocabulary.push({ ...i, count: 1 }); });
                    setData(newData); notify("單字生成完成");
                } catch (e) {}
                setIsGenerating(false);
                setSyncTarget(null);
            };

            // --- Cloud Sync ---
            const handlePull = async (section) => {
                if (!appsScriptUrl) return notify("請輸入 GAS URL", "error");
                try {
                    const res = await fetch(`${appsScriptUrl}?action=pull&section=${section}`);
                    const cloudData = await res.json();
                    if (cloudData) setData(prev => ({ ...prev, [section]: cloudData }));
                    return true;
                } catch (e) { return false; }
            };

            const pullAll = async () => {
                if (!appsScriptUrl) return notify("請輸入 GAS URL", "error");
                notify("全局 Pull 啟動...", "info");
                let successCount = 0;
                for (const section of tabsMapping) {
                    const success = await handlePull(section);
                    if (success) successCount++;
                }
                notify(`同步完成 (${successCount}/${tabsMapping.length})`);
            };

            const handlePush = async () => {
                if (!appsScriptUrl) return notify("請輸入 GAS URL", "error");
                const section = tabsMapping[activeTab];
                notify(`上傳 ${section}...`, "info");
                try {
                    await fetch(appsScriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ action: "push", section, data: data[section] }) });
                    notify("同步成功 (PUSH)");
                } catch (e) { notify("上傳失敗", "error"); }
            };

            // --- CRUD ---
            const addItem = (section) => {
                const newData = { ...data };
                if (section === 'star') newData.star.push({ skill: "新專案名稱", zh: {context: "", action: "", result: ""}, en: {context: "", action: "", result: ""} });
                else if (section === 'homebase') newData.homebase.push({ q: "新困難問題?", framework: "Framework", zh: "", en: "" });
                else if (section === 'seei') newData.seei.push({ topic: "新主題概念", zh: "", en: "" });
                else if (section === 'reverse_qs') newData.reverse_qs.push({ zh: "新的面試反問?", en: "" });
                setData(newData);
            };

            const deleteItem = (section, index) => { const newData = { ...data }; newData[section].splice(index, 1); setData(newData); };

            const speak = async (text, id) => {
                const finalKey = userApiKey || apiKey;
                if (!finalKey) return notify("請填寫 API Key", "error");
                if (isPlaying) return; setIsPlaying(id);
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${finalKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: `Say clearly: ${text}` }] }], 
                            generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } },
                            model: "gemini-2.5-flash-preview-tts"
                        })
                    });
                    const json = await res.json();
                    const pcm = json.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                    if (pcm) {
                        const wav = pcmToWav(pcm); 
                        const audio = new Audio(URL.createObjectURL(wav));
                        audio.playbackRate = playbackSpeed; audio.onended = () => setIsPlaying(null); audio.play();
                    } else { setIsPlaying(null); }
                } catch (e) { setIsPlaying(null); }
            };

            // --- UI Components ---
            const SectionHeader = ({ title, desc, onSyncAI, onAdd }) => (
                <div className="mb-4 bg-white p-3 rounded-2xl border border-slate-200 shadow-sm animate-in flex flex-col md:flex-row md:items-center justify-between gap-2 shrink-0">
                    <div className="flex items-center gap-2">
                        <div className="w-1 h-5 bg-indigo-600 rounded-full"></div>
                        <div>
                            <h2 className="text-base font-black text-slate-800 tracking-tighter uppercase italic leading-none">{title}</h2>
                            <p className="text-[8px] text-slate-400 font-bold uppercase tracking-widest mt-1">{desc}</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-1.5">
                        {onAdd && (
                            <button onClick={onAdd} className="bg-slate-900 text-white px-2 py-1.5 rounded-lg text-[9px] font-black flex items-center gap-1 hover:bg-slate-800 active:scale-95 shadow-sm">
                                <Icon name="plus" size={10}/> ADD
                            </button>
                        )}
                        <button onClick={() => handlePull(tabsMapping[activeTab])} className="bg-white border border-slate-200 text-slate-500 px-2 py-1.5 rounded-lg text-[9px] font-black flex items-center gap-1 hover:bg-slate-50 active:scale-95 shadow-sm">
                            <Icon name="download-cloud" size={10}/> PULL
                        </button>
                        <button onClick={handlePush} className="bg-white border border-slate-200 text-indigo-600 px-2 py-1.5 rounded-lg text-[9px] font-black flex items-center gap-1 hover:bg-indigo-50 active:scale-95 shadow-sm">
                            <Icon name="upload-cloud" size={10}/> PUSH
                        </button>
                        {onSyncAI && (
                            <button onClick={onSyncAI} className="bg-indigo-600 text-white px-3 py-1.5 rounded-lg shadow-md text-[9px] font-black flex items-center gap-1 hover:bg-indigo-700 active:scale-95">
                                <Icon name="sparkles" size={10} className={isGenerating ? "animate-spin" : ""}/> AI SYNC
                            </button>
                        )}
                    </div>
                </div>
            );

            const ItemSubject = ({ index, title, onChange, onSync, onDelete }) => (
                <div className="item-subject-row shrink-0">
                    <div className="flex items-start gap-3 flex-1">
                        {index !== undefined && <div className="bg-indigo-600 text-white w-5 h-5 rounded-md flex items-center justify-center font-black text-[9px] mt-0.5 flex-shrink-0">{index + 1}</div>}
                        <textarea 
                            className="text-sm font-black text-slate-800 bg-transparent border-none p-0 focus:ring-0 w-full resize-none leading-tight" 
                            rows={1}
                            style={{ height: 'auto' }}
                            value={title} 
                            onInput={(e) => { e.target.style.height = 'auto'; e.target.style.height = e.target.scrollHeight + 'px'; }}
                            onChange={(e) => onChange(e.target.value)} 
                        />
                    </div>
                    <div className="flex items-center gap-1.5 flex-shrink-0 mt-0.5">
                        <button onClick={onSync} className="text-slate-300 hover:text-indigo-600 p-1"><Icon name="sparkles" size={14}/></button>
                        <button onClick={onDelete} className="text-slate-200 hover:text-rose-500 p-1"><Icon name="trash-2" size={14}/></button>
                    </div>
                </div>
            );

            const InteractiveText = ({ text }) => {
                if (!text) return <span className="text-slate-300 italic opacity-50 uppercase text-[9px] font-black tracking-widest">Awaiting Content...</span>;
                return (
                    <div className="leading-relaxed">
                        {text.split(/(\s+|[,.;:!?()])/).map((part, i) => {
                            if (/^[a-zA-Z]{3,}$/.test(part)) {
                                return <span key={i} onClick={() => addSpecificWord(part)} className="cursor-pointer border-b border-dashed border-indigo-200 interactive-word px-0.5 transition-all">{part}</span>;
                            }
                            return <span key={i}>{part}</span>;
                        })}
                    </div>
                );
            };

            const LoadingOverlay = ({ dark = false }) => (
                <div className={dark ? "dark-ai-loading-overlay" : "ai-loading-overlay"}>
                    <div className="flex flex-col items-center gap-2">
                        <Icon name="sparkles" size={24} className="text-indigo-500 animate-spin" />
                        <span className={`font-black text-[10px] uppercase tracking-widest pulse-text ${dark ? 'text-indigo-300' : 'text-indigo-600'}`}>Generating...</span>
                    </div>
                </div>
            );

            const tabs = [
                { name: "自我介紹", icon: "user", desc: "Core Pitch" },
                { name: "STAR 範例", icon: "star", desc: "Achievements" },
                { name: "困難問題", icon: "shield-alert", desc: "Q&A Defense" },
                { name: "SEE-I 模型", icon: "message-square", desc: "Mental Model" },
                { name: "關鍵反問", icon: "help-circle", desc: "Reverse Qs" },
                { name: "單字庫", icon: "book-open", desc: "Vocab Assets" }
            ];

            return (
                <div className="h-screen flex flex-col md:flex-row bg-slate-50 overflow-hidden shrink-0">
                    {/* Sidebar */}
                    <nav className="w-full md:w-56 glass-sidebar text-slate-400 p-3 flex flex-col h-full z-20 shrink-0 shadow-2xl">
                        <div className="mb-3 flex items-center justify-between px-1">
                            <h1 className="text-base font-black text-white tracking-tighter uppercase leading-none">ASUS PM<br/><span className="text-indigo-500 text-[10px] tracking-[0.2em]">LAB PRO</span></h1>
                            <button onClick={pullAll} className="bg-indigo-600/20 text-indigo-400 p-1.5 rounded-lg hover:bg-indigo-600/40 border border-indigo-500/20" title="全局同步 (Pull All)">
                                <Icon name="refresh-cw" size={12}/>
                            </button>
                        </div>

                        <div className="space-y-1 mb-3">
                            <div className="relative group">
                                <Icon name="key" size={10} className="absolute left-2.5 top-2.5 text-slate-500 group-focus-within:text-indigo-400" />
                                <input type="password" placeholder="API Key" className="w-full bg-slate-800 text-[9px] py-1.5 pl-8 rounded-lg border border-slate-700 outline-none focus:ring-1 focus:ring-indigo-500 text-white" value={userApiKey} onChange={(e) => setUserApiKey(e.target.value)} />
                            </div>
                            <div className="relative group">
                                <Icon name="cloud" size={10} className="absolute left-2.5 top-2.5 text-slate-500 group-focus-within:text-indigo-400" />
                                <input type="text" placeholder="GAS URL" className="w-full bg-slate-800 text-[9px] py-1.5 pl-8 rounded-lg border border-slate-700 outline-none focus:ring-1 focus:ring-indigo-500 text-white" value={appsScriptUrl} onChange={(e) => setAppsScriptUrl(e.target.value)} />
                            </div>
                            <div className="relative group">
                                <Icon name="link" size={10} className="absolute left-2.5 top-2.5 text-slate-500 group-focus-within:text-indigo-400" />
                                <input type="text" placeholder="Sheet URL" className="w-full bg-slate-800 text-[9px] py-1.5 pl-8 rounded-lg border border-slate-700 outline-none focus:ring-1 focus:ring-indigo-500 text-white" value={sheetUrl} onChange={(e) => setSheetUrl(e.target.value)} />
                            </div>
                        </div>

                        <div className="mb-3 bg-slate-800/50 p-2 rounded-xl border border-slate-700">
                            <label className="text-[8px] font-black text-indigo-400 uppercase tracking-widest block mb-1 flex items-center gap-1 leading-none">
                                <Icon name="settings" size={8}/> AI PROMPT
                            </label>
                            <textarea className="w-full bg-transparent text-[8px] text-slate-300 leading-tight border-none focus:ring-0 p-0 resize-none h-10 custom-scrollbar" value={systemPrompt} onChange={(e) => setSystemPrompt(e.target.value)} />
                        </div>

                        <div className="flex-1 space-y-0.5 overflow-y-auto custom-scrollbar pr-0.5">
                            {tabs.map((tab, idx) => (
                                <button key={idx} onClick={() => setActiveTab(idx)} className={`w-full flex items-center gap-2 px-2.5 py-2 rounded-xl transition-all ${activeTab === idx ? "bg-indigo-600 text-white shadow-inner scale-[1.02]" : "hover:bg-slate-800 hover:text-slate-200"}`}>
                                    <Icon name={tab.icon} size={13} />
                                    <span className="font-black text-[9px] uppercase tracking-widest">{tab.name}</span>
                                </button>
                            ))}
                        </div>
                        
                        <div className="mt-3 pt-2 border-t border-slate-800 shrink-0">
                            <div className="grid grid-cols-5 gap-0.5">
                                {[0.5, 0.75, 1.0, 1.25, 1.5].map(s => (
                                    <button key={s} onClick={() => setPlaybackSpeed(s)} className={`text-[8px] font-black py-1.5 rounded-md transition-all ${playbackSpeed === s ? "bg-indigo-600 text-white shadow-inner" : "bg-slate-800 text-slate-500"}`}>{s}x</button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8 custom-scrollbar relative">
                        <div className="max-w-4xl mx-auto pb-16">
                            {notification && (
                                <div className="fixed top-4 right-4 z-50 flex items-center gap-2 px-3 py-2 bg-white border border-indigo-100 rounded-xl shadow-2xl animate-in">
                                    <div className="w-1.5 h-1.5 rounded-full bg-indigo-600 animate-pulse"></div>
                                    <span className="font-black text-[9px] text-slate-700 uppercase tracking-tight">{notification.message}</span>
                                </div>
                            )}

                            {/* Section: Intro */}
                            {activeTab === 0 && (
                                <div className="animate-in">
                                    <SectionHeader title={tabs[0].name} desc={tabs[0].desc} onSyncAI={() => syncEnglish('intro')} />
                                    <div className="grid lg:grid-cols-2 gap-6">
                                        <div className="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm relative">
                                            <span className="text-[8px] font-black text-indigo-500 uppercase tracking-widest mb-4 block bg-indigo-50 w-fit px-2 py-0.5 rounded">ZH INPUT</span>
                                            <textarea className="w-full h-80 bg-transparent border-none focus:ring-0 text-slate-700 text-base p-0 resize-none outline-none leading-relaxed font-bold shadow-inner" value={data.intro.zh} onChange={(e) => setData({...data, intro: {...data.intro, zh: e.target.value}})} />
                                        </div>
                                        <div className="bg-slate-900 p-6 rounded-[2rem] shadow-2xl flex flex-col relative h-80 overflow-hidden group">
                                            {syncTarget === 'intro' && <LoadingOverlay dark />}
                                            <div className="flex justify-between items-center mb-4 relative z-10">
                                                <span className="text-[8px] font-black text-indigo-400 uppercase tracking-widest leading-none">EN OUTPUT</span>
                                                <button onClick={() => speak(data.intro.en, 'intro')} className="w-8 h-8 bg-white text-slate-900 rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-all"><Icon name="play" size={14} fill="currentColor"/></button>
                                            </div>
                                            <div className="text-white/80 italic font-semibold leading-relaxed text-sm overflow-y-auto custom-scrollbar relative z-10 pr-2">
                                                <InteractiveText text={data.intro.en} />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Section: STAR */}
                            {activeTab === 1 && (
                                <div className="space-y-4 animate-in">
                                    <SectionHeader title={tabs[1].name} desc={tabs[1].desc} onAdd={() => addItem('star')} />
                                    {data.star.map((item, idx) => (
                                        <div key={idx} className="bg-white p-5 rounded-[2rem] border border-slate-200 shadow-sm space-y-3">
                                            <ItemSubject index={idx} title={item.skill} onChange={(v) => { const nd={...data}; nd.star[idx].skill=v; setData(nd); }} onSync={() => syncEnglish('star', idx)} onDelete={() => deleteItem('star', idx)} />
                                            {['context', 'action', 'result'].map(p => (
                                                <div key={p} className="grid lg:grid-cols-2 gap-3">
                                                    <div className="p-3 bg-slate-50 rounded-2xl border border-slate-100 shadow-inner">
                                                        <span className="text-[7px] font-black text-slate-400 uppercase mb-1.5 block tracking-widest leading-none">{p} (ZH)</span>
                                                        <textarea className="w-full bg-transparent border-none p-0 focus:ring-0 text-slate-600 font-bold leading-relaxed text-[13px]" rows={2} value={item.zh[p]} onChange={(e) => { const nd={...data}; nd.star[idx].zh[p]=e.target.value; setData(nd); }} />
                                                    </div>
                                                    <div className="p-3 bg-indigo-50/40 rounded-2xl flex items-start gap-2 border border-indigo-50 shadow-inner relative overflow-hidden">
                                                        {syncTarget === `star-${idx}` && <LoadingOverlay />}
                                                        <button onClick={() => speak(item.en[p], `s-${idx}-${p}`)} className="text-slate-300 hover:text-indigo-600 shrink-0 transition-all p-0.5 mt-0.5"><Icon name="volume-2" size={12}/></button>
                                                        <div className="text-slate-700 italic font-bold leading-relaxed text-[12px]"><InteractiveText text={item.en[p]} /></div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Section: Homebase & SEEI */}
                            {[2, 3].includes(activeTab) && (
                                <div className="space-y-4 animate-in">
                                    <SectionHeader title={tabs[activeTab].name} desc={tabs[activeTab].desc} onAdd={() => addItem(activeTab === 2 ? 'homebase' : 'seei')} />
                                    {(activeTab === 2 ? data.homebase : data.seei).map((item, idx) => (
                                        <div key={idx} className="bg-white p-5 rounded-[2rem] border border-slate-200 shadow-sm space-y-3">
                                            <ItemSubject index={idx} title={activeTab === 2 ? item.q : item.topic} onChange={(v) => { const nd={...data}; if(activeTab===2) nd.homebase[idx].q=v; else nd.seei[idx].topic=v; setData(nd); }} onSync={() => syncEnglish(activeTab === 2 ? 'homebase' : 'seei', idx)} onDelete={() => deleteItem(activeTab === 2 ? 'homebase' : 'seei', idx)} />
                                            <div className="grid lg:grid-cols-2 gap-3">
                                                <textarea className="w-full h-24 bg-slate-50 p-4 rounded-2xl border border-slate-100 focus:ring-0 text-slate-700 font-bold text-xs resize-none shadow-inner" value={item.zh} onChange={(e) => { const nd={...data}; if(activeTab===2) nd.homebase[idx].zh=e.target.value; else nd.seei[idx].zh=e.target.value; setData(nd); }} />
                                                <div className="bg-slate-900 p-4 rounded-2xl text-white overflow-y-auto h-24 custom-scrollbar border border-slate-800 shadow-inner pr-2 relative">
                                                    {syncTarget === `${activeTab === 2 ? 'homebase' : 'seei'}-${idx}` && <LoadingOverlay dark />}
                                                    <div className="flex justify-between mb-2">
                                                        <span className="text-[7px] font-black text-indigo-400 uppercase tracking-widest leading-none">NARRATIVE (EN)</span>
                                                        <button onClick={() => speak(item.en, `h-${idx}`)} className="text-slate-500 hover:text-white transition-all"><Icon name="play" size={10} fill="currentColor"/></button>
                                                    </div>
                                                    <div className="italic font-semibold text-xs leading-relaxed"><InteractiveText text={item.en} /></div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Section: Reverse Qs */}
                            {activeTab === 4 && (
                                <div className="space-y-3 animate-in">
                                    <SectionHeader title={tabs[4].name} desc={tabs[4].desc} onAdd={() => addItem('reverse_qs')} />
                                    {data.reverse_qs.map((rq, idx) => (
                                        <div key={idx} className="bg-white p-4 rounded-2xl border border-slate-200 shadow-sm group">
                                            <ItemSubject index={idx} title={rq.zh} onChange={(v) => { const nd={...data}; nd.reverse_qs[idx].zh=v; setData(nd); }} onSync={() => syncEnglish('reverse_qs', idx)} onDelete={() => deleteItem('reverse_qs', idx)} />
                                            <div className="bg-slate-800 p-3 rounded-xl flex items-center gap-3 border border-slate-700 mt-2 shadow-inner relative overflow-hidden">
                                                {syncTarget === `reverse_qs-${idx}` && <LoadingOverlay dark />}
                                                <button onClick={() => speak(rq.en, `rq-${idx}`)} className="shrink-0 text-slate-500 hover:text-white transition-all"><Icon name="mic" size={12}/></button>
                                                <div className="text-white font-medium italic text-[12px] leading-tight"><InteractiveText text={rq.en} /></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Section: Vocabulary */}
                            {activeTab === 5 && (
                                <div className="space-y-4 animate-in">
                                    <SectionHeader title={tabs[5].name} desc={tabs[5].desc} onSyncAI={generateVocabulary} />
                                    <div className="bg-white rounded-[2rem] border border-slate-200 overflow-hidden shadow-sm divide-y divide-slate-50 max-h-[600px] overflow-y-auto custom-scrollbar relative">
                                        {syncTarget === 'vocabulary' && <div className="sticky top-0 w-full z-20"><LoadingOverlay /></div>}
                                        {data.vocabulary.map((v, idx) => (
                                            <div key={idx} className="p-4 flex flex-col md:flex-row items-center gap-5 group hover:bg-slate-50 transition-colors">
                                                <div className="w-full md:w-40 shrink-0">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className="text-sm font-black text-slate-900 tracking-tighter uppercase">{v.word}</span>
                                                        <button onClick={() => speak(v.word, `v-${idx}`)} className="text-slate-300 group-hover:text-indigo-600 transition-all"><Icon name="volume-2" size={12}/></button>
                                                    </div>
                                                    <div className="flex items-center justify-between">
                                                        <span className="text-indigo-600 font-black text-[9px] bg-indigo-50 px-2 py-0.5 rounded-lg border border-indigo-100/50 leading-none">{v.zh}</span>
                                                        <button onClick={() => { const nd={...data}; nd.vocabulary.splice(idx,1); setData(nd); }} className="text-rose-200 opacity-0 group-hover:opacity-100 hover:text-rose-500 p-1"><Icon name="x" size={12}/></button>
                                                    </div>
                                                </div>
                                                <div className="flex-1 bg-slate-50/50 p-3 rounded-2xl italic text-slate-600 font-bold text-[12px] leading-relaxed border border-slate-100 shadow-inner">
                                                    {v.desc}
                                                </div>
                                            </div>
                                        ))}
                                        {data.vocabulary.length === 0 && <div className="p-20 text-center text-slate-300 font-black uppercase text-[10px] tracking-widest">Vocabulary Assets Empty</div>}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
